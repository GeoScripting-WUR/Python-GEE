<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Arno Timmer" />
  <title>Tutorial ??: Google Earth and in Python</title>
  <style type="text/css">
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

  <!-- bootstrap -->
  <!--<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet"  id="style">-->
  <script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

  <!-- highlight.js -->
  <!--<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/default.min.css" rel="stylesheet" id="code-style">-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/highlight.min.js"></script>
  <script>
  hljs.LANGUAGES.r=function(a){var b="([a-zA-Z]|\\.[a-zA-Z.])[a-zA-Z0-9._]*";return{c:[a.HCM,{b:b,l:b,k:{keyword:"function if in break next repeat else for return switch while try tryCatch|10 stop warning require library attach detach source setMethod setGeneric setGroupGeneric setClass ...|10",literal:"NULL NA TRUE FALSE T F Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10"},r:0},{cN:"number",b:"0[xX][0-9a-fA-F]+[Li]?\\b",r:0},{cN:"number",b:"\\d+(?:[eE][+\\-]?\\d*)?L\\b",r:0},{cN:"number",b:"\\d+\\.(?!\\d)(?:i\\b)?",r:0},{cN:"number",b:"\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[a.BE],r:0},{cN:"string",b:"'",e:"'",c:[a.BE],r:0}]}}(hljs); </script>
  <!--<script type="text/javascript", src="https://yandex.st/highlightjs/7.3/languages/r.min.js"></script>-->

  <!-- Manific Popup -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/0.8.9/jquery.magnific-popup.min.js"></script>

  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script defer="defer">
  // Function to generate the dynamic table of contents
  jQuery.fn.generate_TOC = function () {
    var base = $(this[0]);

    var selectors = ['h1', 'h2', 'h3', 'h4'];

    var last_ptr = [{}, {}, {}, {}];

    var anchors = {};

    generate_anchor = function (text) {
      var test = text.replace(/\W/g, '_');

      while(test in anchors){
        //if no suffix, add one
        if(test.match(/_\d+$/) === null){
          test = test + "_2";
        }
        //else generate unique id for duplicates by adding one to the suffix
        else {
          test = test.replace(/_(\d+)$/, function(match, number){ var num=+number+1; return("_" + num) });
        }
      }
      anchors[test]=1;
      return(test);
    }

    $(selectors.join(',')).filter(function(index) { return $(this).parent().attr("id") != 'header'; }).each(function () {

      var heading = $(this);
      var idx = selectors.indexOf(heading.prop('tagName').toLowerCase());
      var itr = 0;

      while (itr <= idx) {
        if (jQuery.isEmptyObject(last_ptr[itr])) {
          last_ptr[itr] = $('<ul>').addClass('nav');
          if (itr === 0) {
            base.append(last_ptr[itr])
          } else {
            if(last_ptr[itr-1].children('li').length === 0){
              last_ptr[itr-1].append(last_ptr[itr]);
            }
            else {
              last_ptr[itr - 1].children('li').last().append(last_ptr[itr]);
            }
          }
        }
        itr++;
      }
      var anchor = generate_anchor(heading.text());
      heading.attr('id', anchor);
      var a = $('<a>')
      .text(heading.text())
      .attr('href', '#' + anchor);

    var li = $('<li>')
      .append(a);

    last_ptr[idx].append(li);
    for (i = idx + 1; i < last_ptr.length; i++) {
      last_ptr[i] = {};
    }
    });
  }
  /* run scripts when document is ready */
  $(function() {
    "use strict";

    var $window = $(window);
    var $body = $(document.body);

    /* size of thumbnails */

    var hidden_types = ['source']
    var output_types = ['output', 'message', 'warning', 'error']

    /* style tables */
    $('table').addClass('table table-striped table-bordered table-hover table-condensed');

    $('pre code').each(function(i, e) {
      hljs.highlightBlock(e);
    });

    /* Magnific Popup */
    $(".thumbnail").each(function(){
      $(this).magnificPopup({
        disableOn: 768,
        closeOnContentClick: true,

        type: 'image',
        items: {
          src: $(this).find('img').attr('src'),
        }
      });
    });

    function toggle_block(obj, show) {
      var span = obj.find('span');
      if(show === true){
        span.removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
        obj.next('pre').slideDown();
      }
      else {
        span.removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
        obj.next('pre').slideUp();
      }
    }

    function toggle_thumbnails(imgs, show){
      if(show === true){
        imgs.parents().show()
        imgs.slideDown();
      }
      else {
        imgs.slideUp(400, function(){ $(this).parent().hide(); });
      }
    }

    function global_toggle(obj){
      var type = obj.attr('type');
      var show = !obj.parent('li').hasClass('active');
      if(show === true){
        obj.parent('li').addClass('active');
      }
      else{
        obj.parent('li').removeClass('active');
      }
      if(type == 'figure'){
        toggle_thumbnails($('.thumbnail img'), show);
      }
      else {
        $('.toggle.' + type).each(function() { toggle_block($(this), show); });
      }
    }

    /* onclick toggle next code block */
    $('.toggle').click(function() {
      var span = $(this).find('span');
      toggle_block($(this), !span.hasClass('glyphicon-chevron-down'));
      return false
    })

    // global toggles
    $('.toggle-global').click(function(){
      var type = $(this).attr('type');
      if(type === 'all-source'){
          $('li a.source').each(function() {
            global_toggle($(this));
          });
        }
      else if(type === 'all-output'){
        $.each(output_types, function(i, val){
          console.log(val);
          global_toggle($('li a.' + val));
        });
      }
      else {
        console.log($(this));
        global_toggle($(this));
      }
      return false;
    });
    /* table of contents */
    if($(['h1', 'h2', 'h3', 'h4'].join(',')).length > 0){
      $('body > #wrap > .container > .row').append('<div class="col-md-2"><div id="toc" class="well sidebar sidenav affix hidden-print"/></div>');
      $('#toc').generate_TOC();
    }

    $.each(hidden_types, function(i, type) {
      $('li[type=' + type + ']').each(function(){ global_toggle($(this)); });
    });

    /* remove paragraphs with no content */
    $('p:empty').remove();

    $body.scrollspy({
      target: '.sidebar',
    });

    /* theme switch */
    $('.theme-switch').click(function(){
      var css = $('link[title=' + $(this).attr('title') + ']');
      $('#theme[rel=stylesheet]').attr('href', css.attr('href'));
      $('.theme-switch').closest('li').removeClass('active');
      $(this).closest('li').addClass('active');
      return false;
    });
    /* code style switch */ //TODO use same function for both of these?
    $('.highlight-switch').click(function(){
      var css = $('link[title="' + $(this).attr('title') + '"]');
      $('#highlight[rel=stylesheet]').attr('href', css.attr('href'));
      $('.highlight-switch').closest('li').removeClass('active');
      $(this).closest('li').addClass('active');
      return false;
    });

    //TODO refresh on show/hide
    $window.on('load', function () {
      $body.scrollspy('refresh');
    })

  });

  </script>
  <style>
  /* Knitr_bootstrap styles */
  #header {
    display: none !important;
    visibility: hidden !important;
  }
  #wrap .container-fluid {
    padding: 0;
    overflow: hidden;
  }
  .toggle{
    text-transform: capitalize;
  }

  .toggle-global{
    text-transform: capitalize;
  }

  /* Sticky footer styles */
  * {
    margin:0;
  }
  html,
  body {
      height: 100%;
      padding:0 !important;
      /* The html and body elements cannot have any padding or margin. */
      /*overflow-x: hidden;*/
  }

  /* Wrapper for page content to push down footer */
  #wrap {
      min-height: 100%;
      height: auto !important;
      height: 100%;
      /* Negative indent footer by it's height */
      margin: 0 auto -120px;
  }

  /* Set the fixed height of the footer here */
  #push,
  #footer {
      height: 120px;
  }

  #footer {
    text-align: center;
  }

  /* Top level subheader elements.  These are the first nested items underneath a header element. */
  .header li {
    font-size: 20px;
  }

  /* Makes the font smaller for all subheader elements. */
  .sub-header li {
      font-size: 12px;
  }

  button.thumbnails {
    margin-left:0px;
  }

  /*
   * Side navigation
   *
   * Scrollspy and affixed enhanced navigation to highlight sections and secondary
   * sections of docs content.
   */

  /* By default it's not affixed in mobile views, so undo that */
  .sidebar.affix {
    position: static;
  }

  /* First level of nav */
  .sidenav {
    margin-top: 30px;
    margin-bottom: 30px;
    padding-top:    10px;
    padding-bottom: 10px;
    border-radius: 5px;
  }

  /* All levels of nav */
  .sidebar .nav > li > a {
    display: block;
    padding: 5px 20px;
  }
  .sidebar .nav > li > a:hover,
  .sidebar .nav > li > a:focus {
    text-decoration: none;
    border-right: 1px solid;
  }
  .sidebar .nav > .active > a,
  .sidebar .nav > .active:hover > a,
  .sidebar .nav > .active:focus > a {
    font-weight: bold;
    background-color: transparent;
    border-right: 1px solid;
  }

  /* Nav: second level (shown on .active) */
  .sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    margin-bottom: 8px;
  }
  .sidebar .nav .nav > li > a {
    padding-top:    3px;
    padding-bottom: 3px;
    padding-left: 30px;
    font-size: 90%;
  }

  .sidebar .nav .nav .nav > li > a {
    padding-left: 40px;
  }
  .sidebar .nav .nav .nav .nav > li > a {
    padding-left: 50px;
  }

  /* Show and affix the side nav when space allows it */
  @media screen and (min-width: 992px) {
    .sidebar .nav > .active > ul {
      display: block;
    }
    /* Widen the fixed sidebar */
    .sidebar.affix,
    .sidebar.affix-bottom {
      width: 213px;
    }
    .sidebar.affix-top,
    .sidebar.affix {
      position: fixed; /* Undo the static from mobile first approach */
      top: 30px;
    }
    .sidebar.affix-bottom {
      position: absolute; /* Undo the static from mobile first approach */
    }
    .sidebar.affix-bottom .sidenav,
    .sidebar.affix .sidenav {
      margin-top: 0;
      margin-bottom: 0;
    }
  }
  @media screen and (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .sidebar.affix-bottom,
    .sidebar.affix {
      width: 263px;
    }
  }

  #toc {
    padding: 10px 0px;
    margin:0;
    border:0;
  }


  .panel pre {
    margin: 0;
    padding: 0;
    border: 0;
  }
  button + pre {
    margin: 0;
    padding: 0;
  }
  pre code {
    border-radius: 0;
  }
  /* Magnific Popup CSS */
  .mfp-bg {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1042;
    overflow: hidden;
    position: fixed;
    background: #0b0b0b;
    opacity: 0.8;
    filter: alpha(opacity=80); }

  .mfp-wrap {
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1043;
    position: fixed;
    outline: none !important;
    -webkit-backface-visibility: hidden; }

  .mfp-container {
    text-align: center;
    position: absolute;
    width: 100%;
    height: 100%;
    left: 0;
    top: 0;
    padding: 0 8px;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box; }

  .mfp-container:before {
    content: '';
    display: inline-block;
    height: 100%;
    vertical-align: middle; }

  .mfp-align-top .mfp-container:before {
    display: none; }

  .mfp-content {
    position: relative;
    display: inline-block;
    vertical-align: middle;
    margin: 0 auto;
    text-align: left;
    z-index: 1045; }

  .mfp-inline-holder .mfp-content,
  .mfp-ajax-holder .mfp-content {
    width: 100%;
    cursor: auto; }

  .mfp-ajax-cur {
    cursor: progress; }

  .mfp-zoom-out-cur,
  .mfp-zoom-out-cur .mfp-image-holder .mfp-close {
    cursor: -moz-zoom-out;
    cursor: -webkit-zoom-out;
    cursor: zoom-out; }

  .mfp-zoom {
    cursor: pointer;
    cursor: -webkit-zoom-in;
    cursor: -moz-zoom-in;
    cursor: zoom-in; }

  .mfp-auto-cursor .mfp-content {
    cursor: auto; }

  .mfp-close,
  .mfp-arrow,
  .mfp-preloader,
  .mfp-counter {
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none; }

  .mfp-loading.mfp-figure {
    display: none; }

  .mfp-hide {
    display: none !important; }

  .mfp-preloader {
    color: #cccccc;
    position: absolute;
    top: 50%;
    width: auto;
    text-align: center;
    margin-top: -0.8em;
    left: 8px;
    right: 8px;
    z-index: 1044; }

  .mfp-preloader a {
    color: #cccccc; }

  .mfp-preloader a:hover {
    color: white; }

  .mfp-s-ready .mfp-preloader {
    display: none; }

  .mfp-s-error .mfp-content {
    display: none; }

  button.mfp-close,
  button.mfp-arrow {
    overflow: visible;
    cursor: pointer;
    background: transparent;
    border: 0;
    -webkit-appearance: none;
    display: block;
    padding: 0;
    z-index: 1046;
    -webkit-box-shadow: none;
    box-shadow: none; }

  button::-moz-focus-inner {
    padding: 0;
    border: 0; }

  .mfp-close {
    width: 44px;
    height: 44px;
    line-height: 44px;
    position: absolute;
    right: 0;
    top: 0;
    text-decoration: none;
    text-align: center;
    opacity: 0.65;
    padding: 0 0 18px 10px;
    color: white;
    font-style: normal;
    font-size: 28px;
    font-family: Arial, Baskerville, monospace; }
    .mfp-close:hover, .mfp-close:focus {
      opacity: 1; }
    .mfp-close:active {
      top: 1px; }

  .mfp-close-btn-in .mfp-close {
    color: #333333; }

  .mfp-image-holder .mfp-close,
  .mfp-iframe-holder .mfp-close {
    color: white;
    right: -6px;
    text-align: right;
    padding-right: 6px;
    width: 100%; }

  .mfp-counter {
    position: absolute;
    top: 0;
    right: 0;
    color: #cccccc;
    font-size: 12px;
    line-height: 18px; }

  .mfp-arrow {
    position: absolute;
    opacity: 0.65;
    margin: 0;
    top: 50%;
    margin-top: -55px;
    padding: 0;
    width: 90px;
    height: 110px;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0); }

  .mfp-arrow:active {
    margin-top: -54px; }

  .mfp-arrow:hover,
  .mfp-arrow:focus {
    opacity: 1; }

  .mfp-arrow:before, .mfp-arrow:after,
  .mfp-arrow .mfp-b,
  .mfp-arrow .mfp-a {
    content: '';
    display: block;
    width: 0;
    height: 0;
    position: absolute;
    left: 0;
    top: 0;
    margin-top: 35px;
    margin-left: 35px;
    border: medium inset transparent; }
  .mfp-arrow:after,
  .mfp-arrow .mfp-a {
    border-top-width: 13px;
    border-bottom-width: 13px;
    top: 8px; }
  .mfp-arrow:before,
  .mfp-arrow .mfp-b {
    border-top-width: 21px;
    border-bottom-width: 21px; }

  .mfp-arrow-left {
    left: 0; }
    .mfp-arrow-left:after,
    .mfp-arrow-left .mfp-a {
      border-right: 17px solid white;
      margin-left: 31px; }
    .mfp-arrow-left:before,
    .mfp-arrow-left .mfp-b {
      margin-left: 25px;
      border-right: 27px solid #3f3f3f; }

  .mfp-arrow-right {
    right: 0; }
    .mfp-arrow-right:after,
    .mfp-arrow-right .mfp-a {
      border-left: 17px solid white;
      margin-left: 39px; }
    .mfp-arrow-right:before,
    .mfp-arrow-right .mfp-b {
      border-left: 27px solid #3f3f3f; }

  .mfp-iframe-holder {
    padding-top: 40px;
    padding-bottom: 40px; }

  .mfp-iframe-holder .mfp-content {
    line-height: 0;
    width: 100%;
    max-width: 900px; }

  .mfp-iframe-scaler {
    width: 100%;
    height: 0;
    overflow: hidden;
    padding-top: 56.25%; }

  .mfp-iframe-scaler iframe {
    position: absolute;
    display: block;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    background: black; }

  .mfp-iframe-holder .mfp-close {
    top: -40px; }

  /* Main image in popup */
  img.mfp-img {
    width: auto;
    max-width: 100%;
    height: auto;
    display: block;
    line-height: 0;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    padding: 40px 0 40px;
    margin: 0 auto; }

  /* The shadow behind the image */
  .mfp-figure:after {
    content: '';
    position: absolute;
    left: 0;
    top: 40px;
    bottom: 40px;
    display: block;
    right: 0;
    width: auto;
    height: auto;
    z-index: -1;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
    background: #444444; }

  .mfp-figure {
    line-height: 0; }

  .mfp-bottom-bar {
    margin-top: -36px;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    cursor: auto; }

  .mfp-title {
    text-align: left;
    line-height: 18px;
    color: #f3f3f3;
    word-wrap: break-word;
    padding-right: 36px; }

  .mfp-figure small {
    color: #bdbdbd;
    display: block;
    font-size: 12px;
    line-height: 14px; }

  .mfp-image-holder .mfp-content {
    max-width: 100%; }

  .mfp-gallery .mfp-image-holder .mfp-figure {
    cursor: pointer; }

  @media screen and (max-width: 800px) and (orientation: landscape), screen and (max-height: 300px) {
    /**
     * Remove all paddings around the image on small screen
     */
    .mfp-img-mobile .mfp-image-holder {
      padding-left: 0;
      padding-right: 0; }

    .mfp-img-mobile img.mfp-img {
      padding: 0; }

    /* The shadow behind the image */
    .mfp-img-mobile .mfp-figure:after {
      top: 0;
      bottom: 0; }

    .mfp-img-mobile .mfp-bottom-bar {
      background: rgba(0, 0, 0, 0.6);
      bottom: 0;
      margin: 0;
      top: auto;
      padding: 3px 5px;
      position: fixed;
      -webkit-box-sizing: border-box;
      -moz-box-sizing: border-box;
      box-sizing: border-box; }

    .mfp-img-mobile .mfp-bottom-bar:empty {
      padding: 0; }

    .mfp-img-mobile .mfp-counter {
      right: 5px;
      top: 3px; }

    .mfp-img-mobile .mfp-close {
      top: 0;
      right: 0;
      width: 35px;
      height: 35px;
      line-height: 35px;
      background: rgba(0, 0, 0, 0.6);
      position: fixed;
      text-align: center;
      padding: 0; }

    .mfp-img-mobile .mfp-figure small {
      display: inline;
      margin-left: 5px; } }
  @media all and (max-width: 900px) {
    .mfp-arrow {
      -webkit-transform: scale(0.75);
      transform: scale(0.75); }

    .mfp-arrow-left {
      -webkit-transform-origin: 0;
      transform-origin: 0; }

    .mfp-arrow-right {
      -webkit-transform-origin: 100%;
      transform-origin: 100%; }

    .mfp-container {
      padding-left: 6px;
      padding-right: 6px; } }
  .mfp-ie7 .mfp-img {
    padding: 0; }
  .mfp-ie7 .mfp-bottom-bar {
    width: 600px;
    left: 50%;
    margin-left: -300px;
    margin-top: 5px;
    padding-bottom: 5px; }
  .mfp-ie7 .mfp-container {
    padding: 0; }
  .mfp-ie7 .mfp-content {
    padding-top: 44px; }
  .mfp-ie7 .mfp-close {
    top: 0;
    right: 0;
    padding-top: 0; }

  //Magnific overrides
  .mfp-image img{
    background: white;
  }
  .mfp-figure:after {
    background: white;
  }

  /*
   * Off Canvas navbar toggle right
   * --------------------------------------------------
   */

  @media screen and (max-width: 768px) {
    .row-offcanvas .collapsing {
    -webkit-transition: none 0;
      -moz-transition: none 0;
      transition: none 0;
    }
   .row-offcanvas .navbar {
    position: absolute;
    z-index: 2;
      right:0;
      height:100%;
      width:55px;
      border:0;
      background-color:transparent;
    }
    .row-offcanvas .navbar-toggle {
      margin-right: 5px;
      margin-left: 5px;
    }
    .row-offcanvas {
      position: relative;
    }
    .row-offcanvas-right.active .navbar {
    position: absolute;
    z-index: 2;
      right: -28.4%;
      width:40%;
      background-color:#eee;
      border:0 solid #ddd;
      border-left-width:1px;
    }
    .row-offcanvas-right.active {
      left: -30%;
    }
    .row-offcanvas-right.active .navbar-collapse {
      position: relative;
      width: 100%;
    }
    .row-offcanvas .content {
    /*width:calc(100% - 60px);*/
    }
  }
  </style>
</head>
<body>
<title>
Tutorial ??: Google Earth and in Python
</title>
<div id="wrap">
<div class="container">
<div class="row row-offcanvas row-offcanvas-right">
<div class="contents col-xs-12 col-md-10">
<style type="text/css">
body {max-width: none;}
a:visited {color: #91170a;}
</style>
<h1 id="python-and-google-earth-engine">Python and Google Earth
Engine</h1>
<div class="row">
<div class="alert alert-danger">
<p>
<strong>A note on running this tutorial</strong>
</p>
<p>
We recommend using Jupyter Notebook to run the code in this tutorial.
The code today makes use of interactive widgets, which will display
inline when Jupyter Notebooks. You can run the code in an IDE like
Spyder, but where the variable <code>Map</code> is called, you will have
to export the map and look at it in html using the following code:
</p>
<p>
<code>Map.to_html(filename=‘map.html, title=’My Map’, width=‘100%’,
height=‘880px’)</code>
</p>
</div>
</div>
<h3 id="learning-goals-for-today">Learning goals for today:</h3>
<ul>
<li>Get introduced to object oriented programming and learn to read
javascript documentation</li>
<li>Visualize raster and vector data using the google earth engine in
python</li>
<li>Use the python api for earth engine for doing geospatial
analysis.</li>
</ul>
<p>Many of you may already be familiar with or have explored Google
Earth (https://earth.google.com/web/). Within Google Earth, you can
virtually explore the Earth from your computer. The application offers
various maps and information, including the familiar Google Maps base
map and additional layers such as the age of the sea floor. Moreover,
Google Earth (or more accurately, its “engine”) serves as a powerful
cloud-based computational platform for geospatial analysis. It provides
a wealth of information and tools that are accessible to everyone (with
a Google account).</p>
<h2 id="javascript-apis-and-object-oriented-programming">Javascript,
API’s and Object Oriented Programming</h2>
<p>Google Earth Engine (GEE) is the underlying platform behind Google
Earth, initially developed and released as a JavaScript API. But what
exactly does that mean? Let’s break it down into JavaScript and API.</p>
<h3 id="api">API</h3>
<p>An API stands for “Application Programming Interface” and serves as a
standardized language or set of rules that allows different software
components to communicate with each other. APIs are commonly used for
tasks such as accessing data (e.g., weather data from OpenWeatherMap) or
interacting with <a
href="https://geoscripting-wur.github.io/PythonRaster/">a command line
tool: GDAL</a> with python or R, as we covered in the previous
tutorials.</p>
<h3 id="javascript">JavaScript</h3>
<p>JavaScript (JS) is a widely used programming language primarily
employed for web development. It follows an object-oriented programming
(OOP) paradigm, which emphasizes creating reusable code through objects.
Objects in JS can encapsulate both data (properties) and functionality
(methods) within a single entity. OOP differs somewhat from the
programming style we have used thus far, although Python can also be
used as an OOP language. Working with the GEE Python API offers a
fantastic opportunity to become familiar with object-oriented
programming while leveraging the immense power of Google’s engine.</p>
<h3 id="object-oriented-programming-in-python">Object-Oriented
Programming in Python</h3>
<p>In this tutorial, we will learn how to interact with GEE. However,
before we dive into that, it’s essential to understand the principles of
Object-Oriented Programming (OOP) and how it is implemented in
Python.</p>
<p>In Python, objects are created and manipulated using classes. A class
serves as a blueprint that defines the structure and behavior of
objects. It brings together data (properties) and functions (methods)
into a single object.</p>
<p>To define a class in Python, we use the <code>class</code> keyword,
followed by the name of the class. Let’s take a look at an example of a
simple class called <code>Person</code>:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">class Person:
    def __init__(self, name, age):
        self.name = name  # < this is a property
        self.age = age    # < this is also a property
    
    def greet(self):  # < This "function" is a method
        print(f"Hello, my name is {self.name} and I'm {self.age} years old.")</code></pre>
</div>
<p>In the provided code, the <code>__init__</code> method is a special
method known as a <em>constructor</em>. It is automatically invoked when
an object is created from the class. The <code>self</code> parameter
refers to the instance of the class itself, allowing access to its
properties and methods. Whenever a method is defined within a class, we
give <code>self</code> as the first parameter.</p>
<p>The <code>Person</code> class has two properties, <code>name</code>
and <code>age</code>, as well as one method, <code>greet</code>. The
<code>greet</code> method prints a greeting message that includes the
person’s name and age.</p>
<p>To create an instance of the <code>Person</code> class, you simply
call the class as if it were a function and assign the result to a
variable:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">person1 = Person("Alice", 25)
person2 = Person("Bob", 30)</code></pre>
</div>
<p>We have created two objects, <code>person1</code> and
<code>person2</code>, which are instances of the <code>Person</code>
class. Now we can access the properties and call the methods of these
objects:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">print(person1.name)  # Output: Alice
print(person2.age)   # Output: 30
person1.greet()      # Output: Hello, my name is Alice and I'm 25 years old.
person2.greet()      # Output: Hello, my name is Bob and I'm 30 years old.</code></pre>
</div>
<p>This example is straightforward, but keep in mind that classes can
become more complex.</p>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 1</strong>: Take a look at the creation of a GeoPandas
<code>GeoSeries</code> <a
href="https://github.com/geopandas/geopandas/blob/main/geopandas/geoseries.py">here</a>.
It may seem complicated and hard to read, but it is well-documented, so
try to understand some of its functionality. The <code>to_json</code>
method, for example, provides straightforward functionality (though it
may still be challenging to read due to its complexity).
</p>
</blockquote>
</div>
</div>
<p>You may have noticed that class definitions differ from what we have
learned. In the GeoPandas example, the class is defined as follows:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">class GeoSeries(GeoPandasBase, Series):</code></pre>
</div>
<p>However, we previously learned to define a class like this:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">class GeoSeries:</code></pre>
</div>
<p>The difference lies in the code within the parentheses, which
represents <em>inheritance</em>. The class will inherit all the
functionality from the classes specified as arguments, in this case,
<code>GeoPandasBase</code> and <code>Series</code>. The
<code>Series</code> object refers to the <a
href="https://github.com/pandas-dev/pandas/blob/main/pandas/core/series.py#L243C15-L243C15">Pandas.Series</a>,
which contains thousands of lines of code with various functionalities.
Therefore, the GeoPandas <code>GeoSeries</code> contains all the
functionalities implemented in Pandas, as well as those from
<code>GeoPandasBase</code> and <code>GeoPandas.Series</code> itself.</p>
<p>Phew, that’s a lot of complicated code, and it may seem overwhelming.
You don’t need to understand every detail. The important thing is to
grasp the value of classes, objects, and inheritance. How does this work
in a simple example?</p>
<p>So, we’ve learned that with inheritance, classes can acquire all the
functionality from other classes and build upon that. Let’s create a new
object called <code>Student</code>, which will inherit all the
properties and methods from the <code>Person</code> class we created
earlier.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">class Student(Person):
    def __init__(self, name, age, student_id):
        super().__init__(name, age)
        self.student_id = student_id
    
    def study(self):
        print(f"{self.name} is studying.")
</code></pre>
</div>
<p>In the provided code, the <code>Student</code> class inherits from
the <code>Person</code> class, which we will refer to as the superclass.
By doing so, it extends the functionality of the superclass by adding a
new property (<code>student_id</code>) and a new method
(<code>study</code>). The <code>super()</code> function is used to call
the superclass’s <code>__init__</code> method, allowing the subclass to
initialize the inherited properties.</p>
<p>As a result, the <code>Student</code> class contains both the methods
and properties inherited from the <code>Person</code> class, as well as
the additional ones defined within the <code>Student</code> class:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">student = Student("Eve", 22, "123456")
print(student.name)         # Output: Eve
print(student.student_id)   # Output: 123456
student.greet()             # Output: Hello, my name is Eve and I'm 22 years old.
student.study()             # Output: Eve is studying.</code></pre>
</div>
<p>In this example, <code>student</code> is an instance of the
<code>Student</code> class. It can access the inherited properties from
the <code>Person</code> class, such as <code>name</code>, as well as the
newly added property <code>student_id</code>. Similarly, it can invoke
both the inherited method <code>greet</code> and the additional method
<code>study</code>, which are specific to the <code>Student</code>
class.</p>
<h2 id="google-earth-engine">Google Earth Engine</h2>
<p>Google Earth Engine (GEE) is a comprehensive platform that offers a
vast collection of geospatial data along with powerful computational
capabilities. It enables users to analyze and visualize geospatial data
on a global scale, making it a valuable tool for various research
domains such as environmental monitoring and resource management.</p>
<p>One of the prominent features of GEE is its extensive collection of
raster data sources. You can explore the catalog of available datasets
<a
href="https://developers.google.com/earth-engine/datasets/catalog">here</a>.
Additionally, GEE provides access to raster time series and non-raster
data as well. For specific use cases and examples, you can refer to the
article by Pérez-Cutillas and colleagues published this year <a
href="https://www.sciencedirect.com/science/article/pii/S2352938522002154">here</a>.
They conducted a systematic review of research conducted using GEE. From
their article:</p>
<blockquote>
<p>The results of the meta-analysis following the systematic review
showed that: (i) the Landsat 8 was the most widely-used satellite (25%);
(i) the non-parametric classification methods, mainly Random Forest,
were the most recurrent algorithms (31%); and (iii) the water resources
assessment and prediction were the most common methodological
applications (22%).</p>
</blockquote>
<p>– Pérez-Cutillas et al., 2023</p>
<h3 id="nighttime-light-emission">Nighttime Light Emission</h3>
<p>In this tutorial, we will conduct a relatively straightforward
analysis to demonstrate commonly used tools in Google Earth Engine
(GEE). Our main focus is to show you how to work with GEE in Python,
locate tools and documentation, and read the JavaScript (JS)
documentation.</p>
<p>The analysis we will perform involves comparing the amount of light
emitted at night in the Netherlands over time. However, you can choose a
different area for your analysis, as we will be using a global dataset
from 2012 to the present.</p>
<p>To set up the required environment, you will need the following
dependencies. Save the following YAML code in a new file named
<code>env.yaml</code> and create and activate the environment using
mamba</p>
<div class="row">
<button class="source yaml toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> yaml source
</button>
<pre style=""><code class="source yaml">name: pythonGee
channels:
  - conda-forge
dependencies:
  - python=3.10
  - jupyter
  - earthengine-api
  - geemap
  - pygadm
  - geopandas
  - geojson</code></pre>
</div>
<p>To test the environment, try importing the following packages:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import ee
import geemap 
import pygadm
import geopandas as gpd
import geojson</code></pre>
</div>
<p>To work with Google Earth Engine (GEE), you will need a Google
account for authorization. The authentication process can be initiated
by calling the <code>Authenticate</code> function from the
<code>ee</code> module. Follow these steps:</p>
<ol style="list-style-type: decimal">
<li>After running the <code>Authenticate</code> function, a URL will be
printed in the output.</li>
<li>Click on the URL, which will redirect you to a Google account login
page.</li>
<li>Log in to your Google account to create an authorization token.</li>
<li>When prompted with a warning stating that Google has not verified
the app, click “Continue”. This warning is shown because the code we are
about to run is not verified by Google, ensuring your account’s
security.</li>
<li>On the authorization page, select all the checkboxes. This grants
permission to access GEE data and manage data and permissions in the
cloud storage where the analysis will be performed.</li>
<li>Finally, you will see an authorization code. Copy the code and paste
it into the text box that appears after running the
<code>Authenticate</code> function. Press Enter to complete the
authentication process.</li>
</ol>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">ee.Authenticate()</code></pre>
</div>
<p>You now have (hopefully) succesfully authenticated. Next we have to
initialize using the <code>Initialize()</code> method:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">ee.Initialize()</code></pre>
</div>
<p>If you do not encounter any warnings or errors, you have successfully
authenticated and are now ready to work with the Earth Engine library in
Python! Congratulations!</p>
<p>The next time you work in the same environment, you won’t need to
authenticate again. Simply run the <code>Initialize</code> function, and
you’ll be all set to use the Earth Engine library.</p>
<h4 id="some-notes-on-documentation">Some notes on documentation</h4>
<p>In the documentation we will refer to today, you will notice that
there are examples available for both JavaScript and Python (Google
Colab). This is because Google is working on implementing all the
JavaScript functionality in Python. Not all the documentation or
examples are at this time available in Python. Luckily, although the
languages are quite different, the JavaScript and Python implementation
for this package are very similair. It is a good skill to be able to
read some JavaScript. Additionally, we are not sure what documentation
is available for python at the time of following this tutorial. Therefor
we will refer to the JavaScript documentation, but we will highlight any
important differences and provide guidance on using this code in
Python.</p>
<p>Some common differences are the following. To initialize a variable,
in Python you can simply type:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">variablename = 'value'</code></pre>
</div>
<p>In Javascript we can initialize a variable in various ways. The
difference is where this variable in the code will be known:</p>
<div class="row">
<button class="source Javascript toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Javascript source
</button>
<pre style=""><code class="source javascript">var variablename = 'value'
let variablename = 'value'
const variablename = 'value'</code></pre>
</div>
<p>Another often occuring difference in the documentation is how
variables are passed to a function. In python we can do that as we are
used to:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">multiStats = img.reduceRegions(
  collection=regionCol,
  reducer=reducer,
  scale=30,
  crs='EPSG:3310',
)</code></pre>
</div>
<p>In Javascript we have to pass an object, similar to a dictionary in
python:</p>
<div class="row">
<button class="source Javascript toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Javascript source
</button>
<pre style=""><code class="source javascript">var multiStats = img.reduceRegions({
  collection: regionCol,
  reducer: reducer,
  scale: 30,
  crs: 'EPSG:3310',
});</code></pre>
</div>
<p>You do not need to understand this code itself for now, just note the
differences in syntax.</p>
<h3 id="accessing-night-light-data">Accessing Night Light Data</h3>
<p>To analyze the development of light emission over the past 10 years,
we will compare the amount of emitted light per province on a monthly
basis.</p>
<p>For this analysis, we will need data on emitted light. We will use
the VIIRS Nighttime data, which you can learn more about <a
href="https://developers.google.com/earth-engine/datasets/catalog/NOAA_VIIRS_DNB_MONTHLY_V1_VCMCFG">here</a>.
This dataset provides monthly average radiance composite images using
nighttime data from the Visible Infrared Imaging Radiometer Suite
(VIIRS) Day/Night Band (DNB). You can also explore the data in <a
href="https://www.arcgis.com/apps/mapviewer/index.html?layers=edabcbb5407547f5bc883018eb6e7986">this
Esri viewer</a>. To work with this data, we can create an
<code>ImageCollection</code> object. You can refer to the <a
href="https://developers.google.com/earth-engine/apidocs/ee-imagecollection">documentation</a>
for more details.</p>
<p>To create an <code>ImageCollection</code>, you can use the following
command:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Import the night time light emision data.
viirs_image_collection = ee.ImageCollection("NOAA/VIIRS/DNB/MONTHLY_V1/VCMCFG")</code></pre>
</div>
<p>Note that this is the exact same code as in the JS documentation, but
adapted for this tutorial. In Python, to retrieve information about an
object in the form of a dictionary, we need can call the
<code>getInfo()</code> method.</p>
<div class="row">
<button class="source Javascript toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Javascript source
</button>
<pre style=""><code class="source javascript">print('Image collection from a string', ee.ImageCollection("NOAA/VIIRS/DNB/MONTHLY_V1/VCMCFG"));</code></pre>
</div>
<p>In Python, we use the following command:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">print(ee.ImageCollection("NOAA/VIIRS/DNB/MONTHLY_V1/VCMCFG").getInfo()['properties'])</code></pre>
</div>
<p>Here, we call the <code>getInfo</code> method to convert the object
information to a dictionary that we can extract useful information from.
However, when working in Jupyter notebooks, we can simply call the
object itself to display it inline:</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">ee.ImageCollection("NOAA/VIIRS/DNB/MONTHLY_V1/VCMCFG")</code></pre>
</div>
<p>In Jupyter, this will display the ImageCollection object.</p>
<p>Inspecting the ImageCollection object, we can see that it has several
properties. It includes <code>type</code>, <code>id</code>,
<code>version</code>, an empty list for <code>bands</code>, 23
<code>properties</code>, and 132 <code>features</code>. These properties
are similar to what you would expect in a <a
href="https://geojson.org/">GeoJSON</a> representation of a
FeatureCollection.</p>
<p>The <code>type</code>, <code>id</code>, and <code>version</code>
provide information about the data and the object type. At this point,
the object has an empty list for bands, indicating that there are no
bands defined yet. It has 23 properties, which describe information
about the collection as a whole (e.g., it is a monthly collection). The
collection contains features, which are individual images. Each feature
(image) has its own <code>type</code>, <code>id</code>,
<code>version</code>, <code>bands</code>, and <code>properties</code>.
There are no features within these images themselves, as are no
collections.</p>
<h3 id="earth-engine-as-a-viewer">Earth Engine as a viewer</h3>
<p>Now, let’s explore how we can use Google Earth Engine as a viewer. As
mentioned earlier, Google Earth Engine is not only a data collection but
also a platform with tools and a viewer. To interact with the viewer, we
will utilize a package called <code>geemap</code>. Geemap also provides
useful tools, such as data conversion to and from GEE native objects.
We’ll cover this in more detail later.</p>
<p>To create a map, we will follow a few steps outlined in the <a
href="https://geemap.org/get-started/#add-earth-engine-data">geemap
getting started page</a>, modifying it for our use case:</p>
<ol style="list-style-type: decimal">
<li>Initialize a map with a starting position and zoom level. This map
will serve as our base, and we will add layers to it.</li>
<li>Select one image from our image collection.</li>
<li>Add the selected image to the map.</li>
<li>Add a boundary of the Netherlands to the same map.</li>
</ol>
<h4 id="initialize-the-map">Initialize the map</h4>
<p>By following these steps, we will create a map visualization of the
selected image.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># set our initial zoom position for the netherlands
center_lon = 51.962589
center_lat = 5.669627
zoomlevel = 8

# The following line will initialize the map
Map = geemap.Map(center=[center_lon, center_lat], zoom=zoomlevel)

# The following line will actually call and show the map:
Map</code></pre>
</div>
<p>The map will stay and remain in this window unless we instruct it
otherwise. It is an interactive map with 1 standard basemap at the
moment. To start over, you can call <code>Map.clear()</code>, which will
remove all layers and other objects from the map, requiring you to
initialize it again. Sometimes, when working with an interactive widget
like this map, Jupyter might become unresponsive. If you no longer
receive any response (you can test this by running <code>1 + 1</code> in
a new code block), you might need to restart the kernel and begin
again.</p>
<h4 id="select-1-image-and-add-it-to-the-map">Select 1 image and add it
to the map</h4>
<p>Step 1 is complete! The next step is to select one image from the
image collection and add it to the map.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Initial date of interest (inclusive).
from_date = '2017-01-01'
# Final date of interest (exclusive).
to_date = '2023-01-01'

image = viirs_image_collection\
            .filterDate(from_date, to_date)\
            .sort("system:time_start", True)\
            .first()

visualization_params = {
    'min': 0,
    'max': 10,
    'opacity': 0.5,
    'bands': ['avg_rad']
}

Map.addLayer(ee_object = image, 
             vis_params = visualization_params,
             name = 'My First Image')</code></pre>
</div>
<p>In the code snippet provided, several steps are performed to add an
image to the map. In the first line the following happened:</p>
<ol style="list-style-type: decimal">
<li><p>Filtering Images: The <code>viirs_image_collection</code> is
filtered to select only the images between two specified dates using the
<code>filterDate(from_date, to_date)</code> method.</p></li>
<li><p>Sorting the Collection: The filtered image collection is sorted
based on the <code>"system:time_start"</code> property in ascending
order using the <code>sort("system:time_start", ascending)</code>
method. The resulting collection is then assigned to the variable
<code>image</code>.</p></li>
<li><p>Selecting an image: We selected the first image out of the
collection using the <code>first()</code> method.</p></li>
</ol>
<p>We then define visualization parameters and add the image to the
map:</p>
<ol style="list-style-type: decimal">
<li><p>Visualization Parameters: Visualization parameters are defined to
specify how the image should be displayed on the map. This includes the
desired range of values, opacity, and the specific band to visualize
(<code>avg_rad</code> in this case).</p></li>
<li><p>Adding the Image to the Map: The <code>image</code> is added to
the map using the <code>AddLayer</code> method. This method requires the
Earth Engine object (<code>image</code>), the visualization parameters,
and an optional name for the layer.</p></li>
</ol>
<p>By following these steps, the code successfully adds the selected
image to the map, great!</p>
<h4 id="add-the-boundaries-of-the-netherlands-to-the-map">Add the
boundaries of the Netherlands to the map</h4>
<p>The next code will add the boundaries of the Netherlands to the map.
To get the boundary data we use the <code>pygadm</code> package.
<code>pygadm</code> is a dataset project from the University of Berkeley
that provides administrative boundary data on multiple scales for
various regions worldwide. Be careful! The returned data is not always
completely correct, but it suits our purposes for now.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">netherlands = pygadm.get_items(admin='NLD', content_level=1)
ee_netherlands = geemap.geopandas_to_ee(netherlands)

Map.addLayer(ee_object = ee_netherlands, 
             name = 'Netherlands Boundaries')
Map.addLayerControl()</code></pre>
</div>
<p>Using the <code>get_items</code> function, we can obtain the
boundaries at content level 1, which represent the provinces in the
Netherlands. This data is retrieved in the
<code>GeoPandas GeoDataFrame</code> format, which cannot be added to the
map directly. However, we can utilize a convenient conversion tool
provided by the <code>geemap</code> package to convert it into an Earth
Engine feature. The resulting object can then be easily placed on the
map.</p>
<p>For additional examples and tools, we recommend checking out the <a
href="https://github.com/gee-community/geemap/tree/master/examples/notebooks">examples</a>
provided by <code>geemap</code> themselves! It’s worth noting that you
can also <a
href="https://github.com/gee-community/geemap/blob/master/examples/notebooks/21_export_map_to_html_png.ipynb">export
a map to HTML</a>, which might be useful for your project.</p>
<p>Take a look at these examples to further enhance your project and
explore the capabilities offered by <code>geemap</code>.</p>
<p>Great, we have now made a simple map in google earth engine. We added
an image for the whole world and we imported external data and also
visualized that. And it works very quick!</p>
<h3 id="analysis-in-gee">Analysis in GEE</h3>
<p>For the analysis we want to clip the imagery to the boundaries. After
that we want to take the average of all the pixels per province. This
will result in a single value per province per month. Schematically the
steps will look like this:</p>
<ol style="list-style-type: decimal">
<li>Select data: from the ImageCollection, select the band we want to do
the analysis on and filter the collection to the time range we want to
do the analysis on.</li>
<li>Single image: Collapse the image collection into a single image with
many bands</li>
<li>Clip: Clip the images on the boundaries</li>
<li>Calculate the statistics per province</li>
</ol>
<h4 id="selecting-the-data-and-collapsing-it">Selecting the data and
collapsing it</h4>
<p>The first step can be done in one line. Several times we call a
method on an image collection, which will result in an image collection.
On this collection we will call another method and so fort. Look at the
following line of code and try to understand what is happening before
you read the explanation. Use the documentation!</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">viirs_image = viirs_image_collection.select('avg_rad') \
                .filterDate(from_date, to_date) \
                .toBands() </code></pre>
</div>
<p>4 methods are called in one line. In this code we go from an image
collection over all available time steps to a single image of the time
we are interested in, with one band representing an image per month. Why
we collapse it into this single image will become clear in the next
step. The separate methods are described below. 1. First, we select the
band we are interested in, the <code>avg_rad</code> band, containing the
avarage nighttime radiation per month. For this we use the <a
href="https://developers.google.com/earth-engine/apidocs/ee-imagecollection-select"><code>select</code></a>
method. 1. We then select the images from the dates we are interested in
using the <a
href="https://developers.google.com/earth-engine/apidocs/ee-imagecollection-filterdate"><code>filterDate</code></a>
method. 1. Finally we call the <a
href="https://developers.google.com/earth-engine/apidocs/ee-imagecollection-tobands"><code>toBands</code></a>
method. Note that this method results in an <em><code>Image</code></em>
instead of an <em><code>ImageCollection</code></em>.</p>
<p>When you run the code above note that the code is run instantly, no
matter the processing power of your laptop or virtual machine, while
actually it is quite a large computation. How can this be? Actually the
code and the calculation is not done on your computer, in fact there is
no computing done at all yet for this code. This code creates an API
Call, which will be sent to the Earth Engine cloud platform once it
needs to be called. For example when you now call the
<code>viirs_image</code> variable, it takes longer. The API call is sent
and the results are returned to your environment.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">viirs_image</code></pre>
</div>
<h4 id="clipping-the-data">Clipping the data</h4>
<p>Next, we will clip the image to the desired area, the boundary of the
Netherlands. This can be done by using the <a
href="https://developers.google.com/earth-engine/apidocs/ee-image-clip"><code>clip</code></a>
method. We could have also added this to the already long line of code
above. Functionally, this makes no difference. The decision on how to do
this is personal; every programmer might do it differently. The most
important aspect of this choice is to make it clear for yourself and
others what each line is doing and to define clear variable names.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Function to clip an image to the specified geometry
viirs_image_clipped = viirs_image.clip(ee_netherlands)</code></pre>
</div>
<p><code>viirs_image_clipped</code> now contains an image with 36 bands,
verify this in your own environment. Do you understand the band
names?</p>
<p>We now want to calculate the average per province. We do this using a
<em>reducer</em>, which we apply over an area. A reducer is an algorithm
which will be applied over a set of values. The set of values in our
case will be the pixel values within a province. How this works in earth
engine, is that we use a method called <a
href="https://developers.google.com/earth-engine/apidocs/ee-image-reduceregions"><code>reduceRegions</code></a>.
According to the documentation this method needs as input a collection
and a reducer. As input we will give the polygons of the provinces in
the Netherlands: <code>ee_netherlands</code>. As reducer we have
options. To see what the options are, search for <code>reducer</code> in
the filter in the documentation. Since we want the average over the
collection, we will use the <code>ee.Reducer.mean()</code> function,
which is not a reducer itself but it <em>returns</em> a reducer. That
means we will need to actually call the function in the input! We also
pass give the optional parameter scale, and we set it to 300 meters.
Check the documentation to understand what this parameter does.</p>
<p><code>viirs_image_clipped</code> now contains an image with 36 bands.
Please verify this in your own environment.</p>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 2</strong>: Do you understand the band names?
</p>
</blockquote>
</div>
</div>
<h4 id="calculating-statistics">Calculating statistics</h4>
<p>Now, we want to calculate the average radiance per province. We can
achieve this using a <em>reducer</em>, which we apply over an area. A
reducer is an algorithm that is applied over a set of values. In our
case, the set of values will be the pixel values within a province. We
will use a method called <a
href="https://developers.google.com/earth-engine/apidocs/ee-image-reduceregions"><code>reduceRegions</code></a>
to gather this set of values. According to the documentation, this
method requires a collection and a reducer as inputs. We will provide
the polygons of the provinces in the Netherlands, referred to as
<code>ee_netherlands</code>, as the input collection. As for the
reducer, there are various options available. To explore the available
options, you can search for <code>reducer</code> using the filter in the
documentation.</p>
<p>Since we want to take the average over the collection, we will
utilize the <code>ee.Reducer.mean()</code> function. It is important to
note that this function itself is not a reducer, but rather it
<em>returns</em> a reducer. Therefore, we need to actually call the
function as part of the input. Additionally, we provide the optional
parameter <code>scale</code> with a value of 285 meters.</p>
<div class="row">
<div class="alert alert-success">
<blockquote>
<p>
<strong>Question 3</strong>: Why do we chooe 285 meters as scale? Find
out using the documentation of the imagery and the documentation of
<code>reduceRegions</code>.
</p>
</blockquote>
</div>
</div>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">province_statistics = viirs_image_clipped.reduceRegions(
    collection = ee_netherlands,
    reducer = ee.Reducer.mean(),
    scale = 285
)</code></pre>
</div>
<h3 id="external-analysis-and-visualization">External analysis and
visualization</h3>
<p>All right! We now have a FeatureCollection with the average radiation
per province, per month over the given time period. To perform analysis
and visualization, our next step is to calculate the largest difference
within the time period, classify this difference, and display the
results on a map. While this is all possible within Earth Engine, since
you are familiar with working with GeoPandas, it makes sense use what we
know. Exporting the output to a GeoPandas DataFrame and continuing from
there is not a problem at all, so let’s do that.</p>
<p>The steps we will follow are as follows: 1. Export the statistics
FeatureCollection to a GeoPandas DataFrame. 1. Calculate the difference
in radiation per province. 1. Classify this difference into three
classes: small difference, medium difference, and large difference. 1.
Convert the resulting DataFrame back into an Earth Engine object. 1.
Visualize the results.</p>
<h4 id="exporting">Exporting</h4>
<p><code>Geemap</code> provides useful tools for this task. The most
convenient format for us is a <a
href="https://geemap.org/common/?h=ee_to_geotiff#geemap.common.ee_to_geopandas">GeoPandas</a>
object, but there are many other options available as well. Please refer
to the documentation for additional options.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">df = geemap.ee_to_geopandas(province_statistics)</code></pre>
</div>
<h4 id="calculating-differences">Calculating differences</h4>
<p>From here calculating the difference is straight forward, since we
know (geo)pandas well. We now also have all the functionality that comes
with GeoPandas, such as very easily writing the results to a
geojson!</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">df['diff'] = df['20170101_avg_rad'] - df['20230101_avg_rad']
df.to_file('test.geojson', drive='GeoJSON')</code></pre>
</div>
<h4 id="classifying-and-visualizing-trends">Classifying and visualizing
trends</h4>
<p>Now to see how the radiation behaved over time we have to do a little
more work, since the dataframe in this format is not very useful for
this. Read and understand the code below.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">import pandas as pd
import numpy as np 
import matplotlib.pyplot as plt
import matplotlib

# Clean the dataframe a little
clean_df = df.drop(['GID_0', 'GID_1', 'ISO_1', 'HASC_1', 'NAME_0', 'NL_NAME_1', 'VARNAME_1', 'TYPE_1','CC_1', 'ENGTYPE_1'], axis=1)

# Reformat the dataframe so the rows depict measurements per timestamp per province, instead of an attribute per timestamp
melted_df = pd.melt(clean_df, id_vars=['NAME_1', 'geometry', 'diff'] , var_name='date', value_name='value')

# Convert the time string to a datetime format
melted_df['short_date'] = melted_df['date'].str[:8].str.strip()
melted_df['datetime'] = pd.to_datetime(melted_df['short_date'], format="%Y%m%d")


# Initialize the plot
fig, ax = plt.subplots(figsize=(9, 6))

# Create an empty list to save all lines in for the legend 
lines = []

# For each province, add a line with a different color 
for prov in melted_df['NAME_1'].unique():    
    
    # Create a dataframe for the province of interest
    d = melted_df[melted_df['NAME_1'] == prov]
    
    # Generate a random color
    random_rgb_values = list(np.random.random(3))
    random_color = matplotlib.colors.rgb2hex(random_rgb_values, keep_alpha=False)
    
    # Add a line for each province
    lines += ax.plot( d["datetime"].values, d["value"].values, color= random_color, lw=1, zorder=10, label=prov)
    
    
# Add the legend    
ax.legend(handles = lines)</code></pre>
</div>
<p>We can see that there are some differences per province, but that
there does not seem to a nationwide trend. We can also see that in the
summer there is no data for the Netherlands, or in fact for entire
northern europe. This has to do with the nights being so long here in
the summer. Per province there might be a larger difference. To find
out, we can add a trendline to the graph, but this is out of scope for
this tutorial.</p>
<h4 id="classify-differences">Classify differences</h4>
<p>For the visualization we now want to categorize the differences in 3
classes, a little difference, medium difference and a large difference.
To do this we will use a numpy function called <code>linspace</code> and
a pandas function called <code>cut</code>. This results in an array with
datatype <code>CategorizalClasses</code>, which earth engine does not
understand so we convert it to a string.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python"># Create 3 classes
breaks = np.linspace(df['diff'].min() - 0.0001, df['diff'].max(), 4)

# Assign values to classes
classes = ['Low', 'Mid', 'High']
df['class'] = pd.cut(df['diff'], bins=breaks, labels=classes, right=True)

# Convert the datatype to strings so earth engine understands
df['class'] = df['class'].astype('str')</code></pre>
</div>
<h4 id="show-results-on-a-map">Show results on a map</h4>
<p>So the next step is to show the differences on an earth engine map.
To do this, we have to convert the geopandas dataframe back to a earth
engine object. Before we do this we have to tell geopandas what
coordinate refrence system the geometries are in. Strangely the
coordinate system is not exported from earth engine, but it does need it
to be assigned to be imported…</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">df = df.set_crs(4326)
new_ee_statistics = geemap.geopandas_to_ee(df)

# If you run the entire tutorial in one go, the map will show at the same location as it was first initialized.
# To show it hear, clear the map and create a new one. 
# If the map was not initizalized before, this line will throw an error. 
Map.clear()</code></pre>
</div>
<h4 id="style-the-map">Style the map</h4>
<p>Now we have the polygons back in the right format with the classes.
To visualize we define a palette, which tells earth engine which color
we will give to each class. For the legend we can use this dictionary
directly. Of course we also want to add the latest night time imagery
behind it and we want to add a layer control.</p>
<div class="row">
<button class="source Python toggle btn btn-xs btn-primary">
<span class="glyphicon glyphicon-chevron-down"></span> Python source
</button>
<pre style=""><code class="source python">Map = geemap.Map(zoomlevel=8)

palette = {
    'High': 'B81D13', # red
    'Mid': 'EFB700',  # yellow
    'Low': '008450'   # green
}


visualization_params = {
    'min': 0,
    'max': 10,
    'opacity': 0.7,
    'bands': ['20230101_avg_rad']
}

Map.addLayer(ee_object = viirs_image_clipped, 
             vis_params = visualization_params,
             name = 'Night Time')

Map.add_styled_vector(new_ee_statistics, column="class", palette=palette, layer_name="Styled vector")
Map.center_object(new_ee_statistics)

Map.add_legend(legend_title="Legend", legend_dict=palette, position = 'topright')

Map.addLayerControl()

Map</code></pre>
</div>
<h2 id="conclusion">Conclusion</h2>
<p>That marks the end of todays tutorial. Today you learned about many
different things. We began with an introduction about object oriented
programming. We have learned what objects are with methods and
properties and how these can be inherited from other classes. We did
this so we understand JavaScript a little better and we can now
understand the documentation of the Earth Engine API better.</p>
<p>We then used the Python implementation of this API to create maps in
Earth Engine and we did some analysis about light radiation in the
Netherlands. We exported and imported earth engine objects to other
formats we can easier work with, so we can use the tools we know in
combination with the power offered by Google Earth Engine.</p>
</div>
</div>
</div>
<div id="push">

</div>
<div id="footer">
<div class="container">
<p class="text-muted" id="credit">
Styled with
<a href="https://github.com/jimhester/knitrBootstrap">knitrBootstrap</a>
</p>
</div>
</div>
<link rel="stylesheet" id="theme" href="https://netdna.bootstrapcdn.com/bootswatch/3.0.0/simplex/bootstrap.min.css" media="screen"></link><link rel="stylesheet" id="highlight" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.3/styles/tomorrow-night-bright.min.css" media="screen"></link>
</div>
</body>
</html>
